name: Laravel CI

on:
push:
branches: [ "main" ]
pull_request:
branches: [ "main" ]

jobs:
build:
runs-on: ubuntu-latest

services:
mysql:
image: mysql:8
ports: ["3306:3306"]
env:
MYSQL_ROOT_PASSWORD: password
MYSQL_DATABASE: testing
options: >-
--health-cmd "mysqladmin ping --silent"
--health-interval 5s
--health-timeout 3s
--health-retries 5

steps:
- name: Checkout
uses: actions/checkout@v4

- name: Set up PHP
uses: shivammathur/setup-php@v2
with:
php-version: '8.3'
coverage: none
extensions: mbstring, intl, pdo_mysql

- name: Install dependencies
run: composer install --no-interaction --prefer-dist

- name: Generate app key
run: php artisan key:generate

- name: Run Pint
run: vendor/bin/pint --test

- name: Run PHPStan
run: vendor/bin/phpstan analyse

- name: Run PHPUnit
run: vendor/bin/phpunit

- name: Run CodeSniffer
run: vendor/bin/phpcs

- name: Run PHP-CS-Fixer (dry run)
run: vendor/bin/php-cs-fixer fix --dry-run --diff
