
sre@cpp:~/laravel-feature-lab$ docker build --target laravel-production -t laravel-prod -f docker/php/Dockerfile .
[+] Building 12.3s (40/40) FINISHED                                                                                                                                      docker:default
 => [internal] load build definition from Dockerfile                                                                                                                               0.0s
 => => transferring dockerfile: 3.92kB                                                                                                                                             0.0s
 => [internal] load metadata for docker.io/library/composer:2                                                                                                                      0.5s
 => [internal] load metadata for docker.io/library/php:8.3-fpm                                                                                                                     0.6s
 => [internal] load metadata for docker.io/library/node:20-bullseye                                                                                                                0.6s
 => [internal] load .dockerignore                                                                                                                                                  0.0s
 => => transferring context: 93B                                                                                                                                                   0.0s
 => [internal] load build context                                                                                                                                                  0.1s
 => => transferring context: 792.28kB                                                                                                                                              0.1s
 => [node-deps 1/4] FROM docker.io/library/node:20-bullseye@sha256:98ea4012488d9fcf75ff36a4cae490abab3cc95c0b26dd68e7f2ec2d0d61022d                                                0.0s
 => FROM docker.io/library/composer:2@sha256:7384cf9fa70b710af02c9f40bec6e44472e07138efa5ab3428a058087c0d2724                                                                      0.0s
 => CACHED [php-base 1/3] FROM docker.io/library/php:8.3-fpm@sha256:25d6030b5ecd11f7edcbdedbfed3dae55d2032330eed73eaeab5ae0bcb54bc9d                                               0.0s
 => [laravel-production 2/7] RUN groupadd -g 1000 laravel   && useradd -u 1000 -g 1000 -m -s /bin/bash laravel                                                                     0.2s
 => CACHED [php-base 2/3] WORKDIR /var/www/html                                                                                                                                    0.0s
 => CACHED [php-base 3/3] RUN apt-get update     && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends         ca-certificates curl git unzip gnupg2        0.0s
 => CACHED [php-extensions 1/6] RUN apt-get update && apt-get install -y --no-install-recommends         libicu-dev libxml2-dev libgmp-dev libssl-dev uuid-dev     && rm -rf /var  0.0s
 => CACHED [php-extensions 2/6] RUN docker-php-ext-install -j$(nproc)         pdo pdo_pgsql bcmath mbstring exif pcntl zip intl gmp soap dom xml xmlwriter opcache                 0.0s
 => CACHED [php-extensions 3/6] RUN docker-php-ext-configure gd --with-freetype --with-jpeg     && docker-php-ext-install -j$(nproc) gd                                            0.0s
 => CACHED [php-extensions 4/6] RUN pecl channel-update pecl.php.net     && pecl install redis apcu     && docker-php-ext-enable redis apcu                                        0.0s
 => CACHED [php-extensions 5/6] RUN if [ "false" = "true" ]; then         pecl install xdebug && docker-php-ext-enable xdebug;     else echo "Skipping Xdebug installation"; fi    0.0s
 => CACHED [php-extensions 6/6] RUN apt-get purge -y --auto-remove g++     && rm -rf /tmp/* /var/tmp/*                                                                             0.0s
 => CACHED [app-build 1/9] WORKDIR /var/www/html                                                                                                                                   0.0s
 => CACHED [app-build 2/9] RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash -     && apt-get install -y nodejs     && node -v && npm -v                                 0.0s
 => CACHED [composer-deps 1/4] COPY --from=composer:2 /usr/bin/composer /usr/bin/composer                                                                                          0.0s
 => CACHED [composer-deps 2/4] WORKDIR /var/www/html                                                                                                                               0.0s
 => CACHED [composer-deps 3/4] COPY src/composer.json src/composer.lock ./                                                                                                         0.0s
 => CACHED [composer-deps 4/4] RUN composer install --no-dev --prefer-dist --no-interaction --optimize-autoloader --no-scripts                                                     0.0s
 => CACHED [app-build 3/9] COPY --from=composer-deps /var/www/html/vendor ./vendor                                                                                                 0.0s
 => CACHED [node-deps 2/4] WORKDIR /app                                                                                                                                            0.0s
 => CACHED [node-deps 3/4] COPY src/package.json src/package-lock.json ./                                                                                                          0.0s
 => CACHED [node-deps 4/4] RUN npm ci --silent --no-audit                                                                                                                          0.0s
 => CACHED [app-build 4/9] COPY --from=node-deps /app/node_modules ./node_modules                                                                                                  0.0s
 => CACHED [app-build 5/9] COPY src/ ./                                                                                                                                            0.0s
 => CACHED [app-build 6/9] RUN if [ -f package.json ] && grep -q "build" package.json; then         npm run build --if-present;     else echo "No frontend build to run"; fi       0.0s
 => CACHED [app-build 7/9] RUN composer dump-autoload --optimize --classmap-authoritative || true                                                                                  0.0s
 => CACHED [app-build 8/9] RUN php artisan package:discover --ansi || true                                                                                                         0.0s
 => CACHED [app-build 9/9] RUN if [ "production" = "production" ]; then         php artisan config:cache && php artisan route:cache && php artisan view:cache || true;     else e  0.0s
 => [laravel-production 3/7] WORKDIR /var/www/html                                                                                                                                 0.0s
 => [laravel-production 4/7] COPY --from=app-build /var/www/html /var/www/html                                                                                                     0.5s
 => [laravel-production 5/7] RUN chown -R laravel:laravel /var/www/html   && find /var/www/html -type f -exec chmod 0640 {} ;   && find /var/www/html -type d -exec chmod 0750 {}  9.9s
 => [laravel-production 6/7] COPY docker/php/entrypoint.sh /usr/local/bin/entrypoint.sh                                                                                            0.0s
 => [laravel-production 7/7] RUN chmod +x /usr/local/bin/entrypoint.sh                                                                                                             0.1s
 => exporting to image                                                                                                                                                             0.6s
 => => exporting layers                                                                                                                                                            0.6s
 => => writing image sha256:46e82a760b758101dcafe0e37a71bb0900aa532c4b669127a008a2364aa84264                                                                                       0.0s
 => => naming to docker.io/library/laravel-prod                                                                                                                                    0.0s
sre@cpp:~/laravel-feature-lab$ 

sre@cpp:~/laravel-feature-lab$ docker build --no-cache --target laravel-production -t laravel-production -f docker/php/Dockerfile .
[+] Building 142.9s (38/38) FINISHED                                                                                                                                     docker:default
 => [internal] load build definition from Dockerfile                                                                                                                               0.0s
 => => transferring dockerfile: 3.96kB                                                                                                                                             0.0s
 => [internal] load metadata for docker.io/library/composer:2                                                                                                                      0.6s
 => [internal] load metadata for docker.io/library/php:8.3-fpm                                                                                                                     0.5s
 => [internal] load .dockerignore                                                                                                                                                  0.0s
 => => transferring context: 93B                                                                                                                                                   0.0s
 => [internal] load build context                                                                                                                                                  0.1s
 => => transferring context: 792.28kB                                                                                                                                              0.1s
 => CACHED [php-base 1/3] FROM docker.io/library/php:8.3-fpm@sha256:25d6030b5ecd11f7edcbdedbfed3dae55d2032330eed73eaeab5ae0bcb54bc9d                                               0.0s
 => CACHED FROM docker.io/library/composer:2@sha256:7384cf9fa70b710af02c9f40bec6e44472e07138efa5ab3428a058087c0d2724                                                               0.0s
 => CACHED [php-base 2/3] WORKDIR /var/www/html                                                                                                                                    0.0s
 => [php-base 3/3] RUN apt-get update     && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends         ca-certificates curl git unzip gnupg2         zli  10.0s
 => [laravel-production 2/7] RUN groupadd -g 1000 laravel   && useradd -u 1000 -g 1000 -m -s /bin/bash laravel                                                                     0.2s
 => [laravel-production 3/7] WORKDIR /var/www/html                                                                                                                                 0.0s
 => [php-extensions 1/6] RUN apt-get update && apt-get install -y --no-install-recommends         libicu-dev libxml2-dev libgmp-dev libssl-dev uuid-dev     && rm -rf /var/lib/ap  8.4s
 => [php-extensions 2/6] RUN docker-php-ext-install -j$(nproc)         pdo pdo_pgsql bcmath mbstring exif pcntl zip intl gmp soap dom xml xmlwriter opcache                       58.5s 
 => [php-extensions 3/6] RUN docker-php-ext-configure gd --with-freetype --with-jpeg     && docker-php-ext-install -j$(nproc) gd                                                   4.6s 
 => [php-extensions 4/6] RUN pecl channel-update pecl.php.net     && pecl install redis apcu     && docker-php-ext-enable redis apcu                                              23.1s 
 => [php-extensions 5/6] RUN if [ "false" = "true" ]; then         pecl install xdebug && docker-php-ext-enable xdebug;     else echo "Skipping Xdebug installation"; fi           0.1s 
 => [php-extensions 6/6] RUN apt-get purge -y --auto-remove g++     && rm -rf /tmp/* /var/tmp/*                                                                                    0.3s 
 => [composer-deps 1/4] COPY --from=composer:2 /usr/bin/composer /usr/bin/composer                                                                                                 0.0s 
 => [composer-deps 2/4] WORKDIR /var/www/html                                                                                                                                      0.0s 
 => [composer-deps 3/4] COPY src/composer.json src/composer.lock ./                                                                                                                0.0s 
 => [composer-deps 4/4] RUN composer install --no-dev --prefer-dist --no-interaction --optimize-autoloader --no-scripts                                                            3.5s 
 => [node-deps 1/4] RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash -     && apt-get install -y nodejs     && node -v && npm -v                                       13.9s 
 => [node-deps 2/4] WORKDIR /app                                                                                                                                                   0.0s 
 => [node-deps 3/4] COPY src/package.json src/package-lock.json ./                                                                                                                 0.0s 
 => [node-deps 4/4] RUN npm ci --silent --no-audit                                                                                                                                 4.6s 
 => [app-build 1/8] WORKDIR /var/www/html                                                                                                                                          0.0s 
 => [app-build 2/8] COPY --from=composer-deps /var/www/html/vendor ./vendor                                                                                                        0.7s 
 => [app-build 3/8] COPY --from=node-deps /app/node_modules ./node_modules                                                                                                         0.2s 
 => [app-build 4/8] COPY src/ ./                                                                                                                                                   0.8s
 => [app-build 5/8] RUN if [ -f package.json ] && grep -q "build" package.json; then         npm run build --if-present;     else echo "No frontend build to run"; fi              0.6s
 => [app-build 6/8] RUN composer dump-autoload --optimize --classmap-authoritative || true                                                                                         1.0s
 => [app-build 7/8] RUN php artisan package:discover --ansi || true                                                                                                                0.2s
 => [app-build 8/8] RUN if [ "production" = "production" ]; then         php artisan config:cache && php artisan route:cache && php artisan view:cache || true;     else echo "Sk  0.3s 
 => [laravel-production 4/7] COPY --from=app-build /var/www/html /var/www/html                                                                                                     0.5s 
 => [laravel-production 5/7] RUN chown -R laravel:laravel /var/www/html   && find /var/www/html -type f -exec chmod 0640 {} ;   && find /var/www/html -type d -exec chmod 0750 {}  9.9s 
 => [laravel-production 6/7] COPY docker/php/entrypoint.sh /usr/local/bin/entrypoint.sh                                                                                            0.0s
 => [laravel-production 7/7] RUN chmod +x /usr/local/bin/entrypoint.sh                                                                                                             0.1s
 => exporting to image                                                                                                                                                             0.5s
 => => exporting layers                                                                                                                                                            0.5s
 => => writing image sha256:faa5293119c38be42de7e52ad5f0e6534484d7c6c616589f11799290737404e3                                                                                       0.0s
 => => naming to docker.io/library/laravel-production                                                                                                                              0.0s
sre@cpp:~/laravel-feature-lab$ 

